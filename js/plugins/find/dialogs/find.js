(function(){function i(a){return a.type==CKEDITOR.NODE_TEXT&&a.getLength()>0}function h(a){return !(a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}var n=function(){var a=this;return{textNode:a.textNode,offset:a.offset,character:a.textNode?a.textNode.getText().charAt(a.offset):null,hitMatchBoundary:a._.matchBoundary}},m=["find","replace"],l=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]];function k(f){var e,d,c,b;e=f==="find"?1:0;d=1-e;var a,g=l.length;for(a=0;a<g;a++){c=this.getContentElement(m[e],l[a][e]);b=this.getContentElement(m[d],l[a][d]);b.setValue(c.getValue())}}var j=function(z,y){var x=new CKEDITOR.style(CKEDITOR.tools.extend({fullMatch:true,childRule:function(){return false}},z.config.find_highlight)),w=function(p,o){var q=new CKEDITOR.dom.walker(p);q.guard=o?h:null;q.evaluator=i;q.breakOnFalse=true;this._={matchWord:o,walker:q,matchBoundary:false}};w.prototype={next:function(){return this.move()},back:function(){return this.move(true)},move:function(p){var q=this;var o=q.textNode;if(o===null){return n.call(q)}q._.matchBoundary=false;if(o&&p&&q.offset>0){q.offset--;return n.call(q)}else{if(o&&q.offset<o.getLength()-1){q.offset++;return n.call(q)}else{o=null;while(!o){o=q._.walker[p?"previous":"next"].call(q._.walker);if(q._.matchWord&&!o||q._.walker._.end){break}if(!o&&!h(q._.walker.current)){q._.matchBoundary=true}}q.textNode=o;if(o){q.offset=p?o.getLength()-1:0}else{q.offset=0}}}return n.call(q)}};var g=function(p,o){this._={walker:p,cursors:[],rangeLength:o,highlightRange:null,isMatched:false}};g.prototype={toDomRange:function(){var q=new CKEDITOR.dom.range(z.document),p=this._.cursors;if(p.length<1){var s=this._.walker.textNode;if(s){q.setStartAfter(s)}else{return null}}else{var r=p[0],o=p[p.length-1];q.setStart(r.textNode,r.offset);q.setEnd(o.textNode,o.offset+1)}return q},updateFromDomRange:function(p){var q=this;var o,r=new w(p);q._.cursors=[];do{o=r.next();if(o.character){q._.cursors.push(o)}}while(o.character);q._.rangeLength=q._.cursors.length},setMatched:function(){this._.isMatched=true},clearMatched:function(){this._.isMatched=false},isMatched:function(){return this._.isMatched},highlight:function(){var q=this;if(q._.cursors.length<1){return}if(q._.highlightRange){q.removeHighlight()}var p=q.toDomRange();x.applyToRange(p);q._.highlightRange=p;var o=p.startContainer;if(o.type!=CKEDITOR.NODE_ELEMENT){o=o.getParent()}o.scrollIntoView();q.updateFromDomRange(p)},removeHighlight:function(){var o=this;if(!o._.highlightRange){return}x.removeFromRange(o._.highlightRange);o.updateFromDomRange(o._.highlightRange);o._.highlightRange=null},moveBack:function(){var q=this;var p=q._.walker.back(),o=q._.cursors;if(p.hitMatchBoundary){q._.cursors=o=[]}o.unshift(p);if(o.length>q._.rangeLength){o.pop()}return p},moveNext:function(){var q=this;var p=q._.walker.next(),o=q._.cursors;if(p.hitMatchBoundary){q._.cursors=o=[]}o.push(p);if(o.length>q._.rangeLength){o.shift()}return p},getEndCharacter:function(){var o=this._.cursors;if(o.length<1){return null}return o[o.length-1].character},getNextCharacterRange:function(p){var o,r,q=this._.cursors;if((o=q[q.length-1])&&o.textNode){r=new w(f(o))}else{r=this._.walker}return new g(r,p)},getCursors:function(){return this._.cursors}};function f(p,o){var q=new CKEDITOR.dom.range();q.setStart(p.textNode,o?p.offset:p.offset+1);q.setEndAt(z.document.getBody(),CKEDITOR.POSITION_BEFORE_END);return q}function e(p){var o=new CKEDITOR.dom.range();o.setStartAt(z.document.getBody(),CKEDITOR.POSITION_AFTER_START);o.setEnd(p.textNode,p.offset);return o}var d=0,c=1,b=2,a=function(p,o){var r=[-1];if(o){p=p.toLowerCase()}for(var q=0;q<p.length;q++){r.push(r[q]+1);while(r[q+1]>0&&p.charAt(q)!=p.charAt(r[q+1]-1)){r[q+1]=r[r[q+1]-1]+1}}this._={overlap:r,state:0,ignoreCase:!!o,pattern:p}};a.prototype={feedCharacter:function(p){var o=this;if(o._.ignoreCase){p=p.toLowerCase()}for(;;){if(p==o._.pattern.charAt(o._.state)){o._.state++;if(o._.state==o._.pattern.length){o._.state=0;return b}return c}else{if(!o._.state){return d}else{o._.state=o._.overlap[o._.state]}}}return null},reset:function(){this._.state=0}};var D=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,C=function(p){if(!p){return true}var o=p.charCodeAt(0);return o>=9&&o<=13||o>=8192&&o<=8202||D.test(p)},B={searchRange:null,matchRange:null,find:function(N,L,t,s,r,q){var u=this;if(!u.matchRange){u.matchRange=new g(new w(u.searchRange),N.length)}else{u.matchRange.removeHighlight();u.matchRange=u.matchRange.getNextCharacterRange(N.length)}var p=new a(N,!L),o=d,R="%";while(R!==null){u.matchRange.moveNext();while(R=u.matchRange.getEndCharacter()){o=p.feedCharacter(R);if(o==b){break}if(u.matchRange.moveNext().hitMatchBoundary){p.reset()}}if(o==b){if(t){var Q=u.matchRange.getCursors(),P=Q[Q.length-1],O=Q[0],M=new w(e(O),true),v=new w(f(P),true);if(!(C(M.back().character)&&C(v.next().character))){continue}}u.matchRange.setMatched();if(r!==false){u.matchRange.highlight()}return true}}u.matchRange.clearMatched();u.matchRange.removeHighlight();if(s&&!q){u.searchRange=A(true);u.matchRange=null;return arguments.callee.apply(u,Array.prototype.slice.call(arguments).concat([true]))}return false},replaceCounter:0,replace:function(v,u,t,s,r,q,p){var I=this;var o=false;if(I.matchRange&&I.matchRange.isMatched()&&!I.matchRange._.isReplaced){I.matchRange.removeHighlight();var L=I.matchRange.toDomRange(),K=z.document.createText(t);if(!p){var J=z.getSelection();J.selectRanges([L]);z.fire("saveSnapshot")}L.deleteContents();L.insertNode(K);if(!p){J.selectRanges([L]);z.fire("saveSnapshot")}I.matchRange.updateFromDomRange(L);if(!p){I.matchRange.highlight()}I.matchRange._.isReplaced=true;I.replaceCounter++;o=true}else{o=I.find(u,s,r,q,!p)}return o}};function A(p){var o,r=z.getSelection(),q=z.document.getBody();if(r&&!p){o=r.getRanges()[0].clone();o.collapse(true)}else{o=new CKEDITOR.dom.range();o.setStartAt(q,CKEDITOR.POSITION_AFTER_START)}o.setEndAt(q,CKEDITOR.POSITION_BEFORE_END);return o}return{title:z.lang.findAndReplace.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:165,buttons:[CKEDITOR.dialog.cancelButton],contents:[{id:"find",label:z.lang.findAndReplace.find,title:z.lang.findAndReplace.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:z.lang.findAndReplace.findWhat,isChanged:false,labelLayout:"horizontal",accessKey:"F"},{type:"button",align:"left",style:"width:100%",label:z.lang.findAndReplace.find,onClick:function(){var o=this.getDialog();if(!B.find(o.getValueOf("find","txtFindFind"),o.getValueOf("find","txtFindCaseChk"),o.getValueOf("find","txtFindWordChk"),o.getValueOf("find","txtFindCyclic"))){alert(z.lang.findAndReplace.notFoundMsg)}}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:false,style:"margin-top:28px",label:z.lang.findAndReplace.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:false,label:z.lang.findAndReplace.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:false,"default":true,label:z.lang.findAndReplace.matchCyclic}]}]},{id:"replace",label:z.lang.findAndReplace.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:z.lang.findAndReplace.findWhat,isChanged:false,labelLayout:"horizontal",accessKey:"F"},{type:"button",align:"left",style:"width:100%",label:z.lang.findAndReplace.replace,onClick:function(){var o=this.getDialog();if(!B.replace(o,o.getValueOf("replace","txtFindReplace"),o.getValueOf("replace","txtReplace"),o.getValueOf("replace","txtReplaceCaseChk"),o.getValueOf("replace","txtReplaceWordChk"),o.getValueOf("replace","txtReplaceCyclic"))){alert(z.lang.findAndReplace.notFoundMsg)}}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:z.lang.findAndReplace.replaceWith,isChanged:false,labelLayout:"horizontal",accessKey:"R"},{type:"button",align:"left",style:"width:100%",label:z.lang.findAndReplace.replaceAll,isChanged:false,onClick:function(){var p=this.getDialog(),o;B.replaceCounter=0;B.searchRange=A(true);if(B.matchRange){B.matchRange.removeHighlight();B.matchRange=null}z.fire("saveSnapshot");while(B.replace(p,p.getValueOf("replace","txtFindReplace"),p.getValueOf("replace","txtReplace"),p.getValueOf("replace","txtReplaceCaseChk"),p.getValueOf("replace","txtReplaceWordChk"),false,true)){}if(B.replaceCounter){alert(z.lang.findAndReplace.replaceSuccessMsg.replace(/%1/,B.replaceCounter));z.fire("saveSnapshot")}else{alert(z.lang.findAndReplace.notFoundMsg)}}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:false,label:z.lang.findAndReplace.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:false,label:z.lang.findAndReplace.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:false,"default":true,label:z.lang.findAndReplace.matchCyclic}]}]}],onLoad:function(){var p=this,o,r,q=false;this.on("hide",function(){q=false});this.on("show",function(){q=true});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(s){return function(H){s.call(p,H);var G=p._.tabs[H],v,u,t;u=H==="find"?"txtFindFind":"txtFindReplace";t=H==="find"?"txtFindWordChk":"txtReplaceWordChk";o=p.getContentElement(H,u);r=p.getContentElement(H,t);if(!G.initialized){v=CKEDITOR.document.getById(o._.inputId);G.initialized=true}if(q){k.call(this,H)}}})},onShow:function(){B.searchRange=A();this.selectPage(y)},onHide:function(){var o;if(B.matchRange&&B.matchRange.isMatched()){B.matchRange.removeHighlight();z.focus();o=B.matchRange.toDomRange();if(o){z.getSelection().selectRanges([o])}}delete B.matchRange},onFocus:function(){if(y=="replace"){return this.getContentElement("replace","txtFindReplace")}else{return this.getContentElement("find","txtFindFind")}}}};CKEDITOR.dialog.add("find",function(a){return j(a,"find")});CKEDITOR.dialog.add("replace",function(a){return j(a,"replace")})})();