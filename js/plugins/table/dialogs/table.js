(function(){var f=/^(\d+(?:\.\d+)?)(px|%)$/,e=/^(\d+(?:\.\d+)?)px$/,h=function(b){var a=this.id;if(!b.info){b.info={}}b.info[a]=this.getValue()};function g(c,b){var a=function(d){return new CKEDITOR.dom.element(d,c.document)};return{title:c.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onShow:function(){var u=this;var t=c.getSelection(),s=t.getRanges(),r=null,q=u.getContentElement("info","txtRows"),p=u.getContentElement("info","txtCols"),d=u.getContentElement("info","txtWidth");if(b=="tableProperties"){if(r=c.getSelection().getSelectedElement()){if(r.getName()!="table"){r=null}}else{if(s.length>0){if(CKEDITOR.env.webkit){s[0].shrink(CKEDITOR.NODE_ELEMENT)}var v=s[0].getCommonAncestor(true);r=v.getAscendant("table",true)}}u._.selectedElement=r}if(r){u.setupContent(r);q&&q.disable();p&&p.disable();d&&d.select()}else{q&&q.enable();p&&p.enable();q&&q.select()}},onOk:function(){var K=this;if(K._.selectedElement){var X=c.getSelection(),W=c.getSelection().createBookmarks()}var V=K._.selectedElement||a("table"),U=K,T={};K.commitContent(T,V);if(T.info){var S=T.info;if(!K._.selectedElement){var R=V.append(a("tbody")),Q=parseInt(S.txtRows,10)||0,P=parseInt(S.txtCols,10)||0;for(var N=0;N<Q;N++){var L=R.append(a("tr"));for(var J=0;J<P;J++){var I=L.append(a("td"));if(!CKEDITOR.env.ie){I.append(a("br"))}}}}var H=S.selHeaders;if(!V.$.tHead&&(H=="row"||H=="both")){var G=new CKEDITOR.dom.element(V.$.createTHead());R=V.getElementsByTag("tbody").getItem(0);var F=R.getElementsByTag("tr").getItem(0);for(N=0;N<F.getChildCount();N++){var E=F.getChild(N);if(E.type==CKEDITOR.NODE_ELEMENT){E.renameNode("th");E.setAttribute("scope","col")}}G.append(F.remove())}if(V.$.tHead!==null&&!(H=="row"||H=="both")){G=new CKEDITOR.dom.element(V.$.tHead);R=V.getElementsByTag("tbody").getItem(0);var D=R.getFirst();while(G.getChildCount()>0){F=G.getFirst();for(N=0;N<F.getChildCount();N++){var d=F.getChild(N);if(d.type==CKEDITOR.NODE_ELEMENT){d.renameNode("td");d.removeAttribute("scope")}}F.insertBefore(D)}G.remove()}if(!K.hasColumnHeaders&&(H=="col"||H=="both")){for(L=0;L<V.$.rows.length;L++){d=new CKEDITOR.dom.element(V.$.rows[L].cells[0]);d.renameNode("th");d.setAttribute("scope","row")}}if(K.hasColumnHeaders&&!(H=="col"||H=="both")){for(N=0;N<V.$.rows.length;N++){L=new CKEDITOR.dom.element(V.$.rows[N]);if(L.getParent().getName()=="tbody"){d=new CKEDITOR.dom.element(L.$.cells[0]);d.renameNode("td");d.removeAttribute("scope")}}}var O=[];if(S.txtHeight){V.setStyle("height",CKEDITOR.tools.cssLength(S.txtHeight))}else{V.removeStyle("height")}if(S.txtWidth){var M=S.cmbWidthType||"pixels";V.setStyle("width",S.txtWidth+(M=="pixels"?"px":"%"))}else{V.removeStyle("width")}if(!V.getAttribute("style")){V.removeAttribute("style")}}if(!K._.selectedElement){c.insertElement(V)}else{X.selectBookmarks(W)}return true},contents:[{id:"info",label:c.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:c.lang.table.rows,required:true,style:"width:5em",validate:function(){var j=true,d=this.getValue();j=j&&CKEDITOR.dialog.validate.integer()(d)&&d>0;if(!j){alert(c.lang.table.invalidRows);this.select()}return j},setup:function(d){this.setValue(d.$.rows.length)},commit:h},{type:"text",id:"txtCols","default":2,label:c.lang.table.columns,required:true,style:"width:5em",validate:function(){var j=true,d=this.getValue();j=j&&CKEDITOR.dialog.validate.integer()(d)&&d>0;if(!j){alert(c.lang.table.invalidCols);this.select()}return j},setup:function(d){this.setValue(d.$.rows[0].cells.length)},commit:h},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders","default":"",label:c.lang.table.headers,items:[[c.lang.table.headersNone,""],[c.lang.table.headersRow,"row"],[c.lang.table.headersColumn,"col"],[c.lang.table.headersBoth,"both"]],setup:function(l){var k=this.getDialog();k.hasColumnHeaders=true;for(var d=0;d<l.$.rows.length;d++){if(l.$.rows[d].cells[0].nodeName.toLowerCase()!="th"){k.hasColumnHeaders=false;break}}if(l.$.tHead!==null){this.setValue(k.hasColumnHeaders?"both":"row")}else{this.setValue(k.hasColumnHeaders?"col":"")}},commit:h},{type:"text",id:"txtBorder","default":1,label:c.lang.table.border,style:"width:3em",validate:CKEDITOR.dialog.validate.number(c.lang.table.invalidBorder),setup:function(d){this.setValue(d.getAttribute("border")||"")},commit:function(j,d){if(this.getValue()){d.setAttribute("border",this.getValue())}else{d.removeAttribute("border")}}},{id:"cmbAlign",type:"select","default":"",label:c.lang.table.align,items:[[c.lang.common.notSet,""],[c.lang.table.alignLeft,"left"],[c.lang.table.alignCenter,"center"],[c.lang.table.alignRight,"right"]],setup:function(d){this.setValue(d.getAttribute("align")||"")},commit:function(j,d){if(this.getValue()){d.setAttribute("align",this.getValue())}else{d.removeAttribute("align")}}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",style:"width:5em",label:c.lang.table.width,"default":200,validate:CKEDITOR.dialog.validate.number(c.lang.table.invalidWidth),onLoad:function(){var n=this.getDialog().getContentElement("info","cmbWidthType"),m=n.getElement(),l=this.getInputElement(),d=l.getAttribute("aria-labelledby");l.setAttribute("aria-labelledby",[d,m.$.id].join(" "))},setup:function(j){var d=f.exec(j.$.style.width);if(d){this.setValue(d[1])}else{this.setValue("")}},commit:h},{id:"cmbWidthType",type:"select",label:c.lang.table.widthUnit,labelStyle:"visibility:hidden","default":"pixels",items:[[c.lang.table.widthPx,"pixels"],[c.lang.table.widthPc,"percents"]],setup:function(j){var d=f.exec(j.$.style.width);if(d){this.setValue(d[2]=="px"?"pixels":"percents")}},commit:h}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",style:"width:5em",label:c.lang.table.height,"default":"",validate:CKEDITOR.dialog.validate.number(c.lang.table.invalidHeight),onLoad:function(){var n=this.getDialog().getContentElement("info","htmlHeightType"),m=n.getElement(),l=this.getInputElement(),d=l.getAttribute("aria-labelledby");l.setAttribute("aria-labelledby",[d,m.$.id].join(" "))},setup:function(j){var d=e.exec(j.$.style.height);if(d){this.setValue(d[1])}},commit:h},{id:"htmlHeightType",type:"html",html:"<div><br />"+c.lang.table.widthPx+"</div>"}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",style:"width:3em",label:c.lang.table.cellSpace,"default":1,validate:CKEDITOR.dialog.validate.number(c.lang.table.invalidCellSpacing),setup:function(d){this.setValue(d.getAttribute("cellSpacing")||"")},commit:function(j,d){if(this.getValue()){d.setAttribute("cellSpacing",this.getValue())}else{d.removeAttribute("cellSpacing")}}},{type:"text",id:"txtCellPad",style:"width:3em",label:c.lang.table.cellPad,"default":1,validate:CKEDITOR.dialog.validate.number(c.lang.table.invalidCellPadding),setup:function(d){this.setValue(d.getAttribute("cellPadding")||"")},commit:function(j,d){if(this.getValue()){d.setAttribute("cellPadding",this.getValue())}else{d.removeAttribute("cellPadding")}}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",label:c.lang.table.caption,setup:function(l){var k=l.getElementsByTag("caption");if(k.count()>0){var d=k.getItem(0);d=d.getChild(0)&&d.getChild(0).getText()||"";d=CKEDITOR.tools.trim(d);this.setValue(d)}},commit:function(p,o){var n=this.getValue(),m=o.getElementsByTag("caption");if(n){if(m.count()>0){m=m.getItem(0);m.setHtml("")}else{m=new CKEDITOR.dom.element("caption",c.document);if(o.getChildCount()){m.insertBefore(o.getFirst())}else{m.appendTo(o)}}m.append(new CKEDITOR.dom.text(n,c.document))}else{if(m.count()>0){for(var d=m.count()-1;d>=0;d--){m.getItem(d).remove()}}}}},{type:"text",id:"txtSummary",label:c.lang.table.summary,setup:function(d){this.setValue(d.getAttribute("summary")||"")},commit:function(j,d){if(this.getValue()){d.setAttribute("summary",this.getValue())}else{d.removeAttribute("summary")}}}]}]}]}}CKEDITOR.dialog.add("table",function(a){return g(a,"table")});CKEDITOR.dialog.add("tableProperties",function(a){return g(a,"tableProperties")})})();