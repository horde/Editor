(function(){var i=CKEDITOR.htmlParser.fragment.prototype,h=CKEDITOR.htmlParser.element.prototype;i.onlyChild=h.onlyChild=function(){var c=this.children,b=c.length,a=b==1&&c[0];return a||null};h.removeAnyChildWithName=function(e){var d=this.children,c=[],b;for(var a=0;a<d.length;a++){b=d[a];if(!b.name){continue}if(b.name==e){c.push(b);d.splice(a--,1)}c=c.concat(b.removeAnyChildWithName(e))}return c};h.getAncestor=function(b){var a=this.parent;while(a&&!(a.name&&a.name.match(b))){a=a.parent}return a};i.firstChild=h.firstChild=function(c){var b;for(var a=0;a<this.children.length;a++){b=this.children[a];if(c(b)){return b}else{if(b.name){b=b.firstChild(c);if(b){return b}}}}return null};h.addStyle=function(f,e,d){var g=this;var c,b="";if(typeof e=="string"){b+=f+":"+e+";"}else{if(typeof f=="object"){for(var a in f){if(f.hasOwnProperty(a)){b+=a+":"+f[a]+";"}}}else{b+=f}d=e}if(!g.attributes){g.attributes={}}c=g.attributes.style||"";c=(d?[b,c]:[c,b]).join(";");g.attributes.style=c.replace(/^;|;(?=;)/,"")};CKEDITOR.dtd.parentOf=function(c){var b={};for(var a in this){if(a.indexOf("$")==-1&&this[a][c]){b[a]=1}}return b};var n=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,m=/^(?:\b0[^\s]*\s*){1,4}$/,l=0,k;CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(d,c){var b=new CKEDITOR.htmlParser.element("cke:listbullet"),a;if(!d){d="decimal";a="ol"}else{if(d[2]){if(!isNaN(d[1])){d="decimal"}else{if(/^[a-z]+$/.test(d[1])){d="lower-alpha"}else{if(/^[A-Z]+$/.test(d[1])){d="upper-alpha"}else{d="decimal"}}}a="ol"}else{if(/[l\u00B7\u2002]/.test(d[1])){d="disc"}else{if(/[\u006F\u00D8]/.test(d[1])){d="circle"}else{if(/[\u006E\u25C6]/.test(d[1])){d="square"}else{d="disc"}}}a="ul"}}b.attributes={"cke:listtype":a,style:"list-style-type:"+d+";"};b.add(new CKEDITOR.htmlParser.text(c));return b},isListBulletIndicator:function(b){var a=b.attributes&&b.attributes.style;if(/mso-list\s*:\s*Ignore/i.test(a)){return true}},isContainingOnlySpaces:function(b){var a;return(a=b.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(a.value)},resolveList:function(e){var d=e.attributes,c;if((c=e.removeAnyChildWithName("cke:listbullet"))&&c.length&&(c=c[0])){e.name="cke:li";if(d.style){d.style=CKEDITOR.plugins.pastefromword.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(f){var g=f.split(" ");f=g[3]||g[1]||g[0];f=parseInt(f,10);if(!l&&k&&f>k){l=f-k}d["cke:margin"]=k=f}]])(d.style,e)||""}var b=c.attributes,a=b.style;e.addStyle(a);CKEDITOR.tools.extend(d,b);return true}return false},convertToPx:(function(){var a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(a);return function(b){if(n.test(b)){a.setStyle("width",b);return a.$.clientWidth+"px"}return b}})(),getStyleComponents:(function(){var a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(a);return function(f,e,d){a.setStyle(f,e);var c={},b=d.length;for(var g=0;g<b;g++){c[d[g]]=a.getStyle(d[g])}return c}})(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(w){var v=w.attributes,u=w.parent,t,g=1;while(u){u.attributes&&u.attributes["cke:list"]&&g++;u=u.parent}switch(v.type){case"a":t="lower-alpha";break}var f=w.children,e;for(var d=0;d<f.length;d++){e=f[d];var c=e.attributes;if(e.name in CKEDITOR.dtd.$listItem){var b=e.children,a=b.length,x=b[a-1];if(x.name in CKEDITOR.dtd.$list){f.splice(d+1,0,x);x.parent=w;if(!--b.length){f.splice(d,1)}}e.name="cke:li";c["cke:indent"]=g;k=0;c["cke:listtype"]=w.name;t&&e.addStyle("list-style-type",t,true)}}delete w.name;v["cke:list"]=1},assembleList:function(y){var x=y.children,w,v,g,f,e,d,c,b,a;for(var B=0;B<x.length;B++){w=x[B];if("cke:li"==w.name){w.name="li";v=w;g=v.attributes;f=v.attributes["cke:listtype"];e=parseInt(g["cke:indent"],10)||l&&Math.ceil(g["cke:margin"]/l)||1;g.style&&(g.style=CKEDITOR.plugins.pastefromword.filters.stylesFilter([["list-style-type",f=="ol"?"decimal":"disc"]])(g.style)||"");if(!c){c=new CKEDITOR.htmlParser.element(f);c.add(v);x[B]=c}else{if(e>a){c=new CKEDITOR.htmlParser.element(f);c.add(v);d.add(c)}else{if(e<a){var A=a-e,z;while(A--&&(z=c.parent)){c=z.parent}c.add(v)}else{c.add(v)}}x.splice(B--,1)}d=v;a=e}else{c=null}}l=0},falsyFilter:function(a){return false},stylesFilter:function(b,a){return function(f,e){var d=[];f.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(B,A,z){A=A.toLowerCase();A=="font-family"&&(z=z.replace(/["']/g,""));var y,x,w,v;for(var g=0;g<b.length;g++){if(b[g]){y=b[g][0];x=b[g][1];w=b[g][2];v=b[g][3];if(A.match(y)&&(!x||z.match(x))){A=v||A;a&&(w=w||z);if(typeof w=="function"){w=w(z,e,A)}if(w&&w.push){A=w[0],w=w[1]}if(typeof w=="string"){d.push([A,w])}return}}}!a&&d.push([A,z])});for(var c=0;c<d.length;c++){d[c]=d[c].join(":")}return d.length?d.join(";")+";":false}},elementMigrateFilter:function(b,a){return function(d){var c=a?new CKEDITOR.style(b,a)._.definition:b;d.name=c.element;CKEDITOR.tools.extend(d.attributes,CKEDITOR.tools.clone(c.attributes));d.addStyle(CKEDITOR.style.getStyleText(c))}},styleMigrateFilter:function(c,b){var a=this.elementMigrateFilter;return function(f,e){var d=new CKEDITOR.htmlParser.element(null),g={};g[b]=f;a(c,g)(d);d.children=e.children;e.children=[d]}},bogusAttrFilter:function(b,a){if(a.name.indexOf("cke:")==-1){return false}},applyStyleFilter:null},getRules:function(N){var M=CKEDITOR.dtd,L=CKEDITOR.tools.extend({},M.$block,M.$listItem,M.$tableContent),K=N.config,J=this.filters,I=J.falsyFilter,H=J.stylesFilter,G=J.elementMigrateFilter,F=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),D=this.utils.createListBulletMarker,C=J.flattenList,B=J.assembleList,g=this.utils.isListBulletIndicator,f=this.utils.isContainingOnlySpaces,e=this.utils.resolveList,d=this.utils.convertToPx,c=this.utils.getStyleComponents,b=this.utils.listDtdParents,a=K.pasteFromWordRemoveFontStyles!==false,E=K.pasteFromWordRemoveStyles!==false;return{elementNames:[[/meta|link|script/,""]],root:function(o){o.filterChildren();B(o)},elements:{"^":function(p){var o;if(CKEDITOR.env.gecko&&(o=J.applyStyleFilter)){o(p)}},$:function(r){var q=r.name||"",p=r.attributes;if(q in L&&p.style){p.style=H([[/^(:?width|height)$/,null,d]])(p.style)||""}if(q.match(/h\d/)){r.filterChildren();if(e(r)){return}G(K["format_"+q])(r)}else{if(q in M.$inline){r.filterChildren();if(f(r)){delete r.name}}else{if(q.indexOf(":")!=-1&&q.indexOf("cke")==-1){r.filterChildren();if(q=="v:imagedata"){var o=r.attributes["o:href"];if(o){r.attributes.src=o}r.name="img";return}delete r.name}}}if(q in b){r.filterChildren();B(r)}},style:function(r){if(CKEDITOR.env.gecko){var q=r.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),p=q&&q[1],o={};if(p){p.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(x,w,v){w=w.split(",");var u=w.length,t;for(var s=0;s<u;s++){CKEDITOR.tools.trim(w[s]).replace(/^(\w+)(\.[\w-]+)?$/g,function(y,A,z){A=A||"*";z=z.substring(1,z.length);if(z.match(/MsoNormal/)){return}if(!o[A]){o[A]={}}if(z){o[A][z]=v}else{o[A]=v}})}});J.applyStyleFilter=function(v){var u=o["*"]?"*":v.name,t=v.attributes&&v.attributes["class"],s;if(u in o){s=o[u];if(typeof s=="object"){s=s[t]}s&&v.addStyle(s,true)}}}}return false},p:function(o){o.filterChildren();if(e(o)){return}if(K.enterMode==CKEDITOR.ENTER_BR){delete o.name;o.add(new CKEDITOR.htmlParser.element("br"))}else{G(K["format_"+(K.enterMode==CKEDITOR.ENTER_P?"p":"div")])(o)}},div:function(r){var q=r.onlyChild();if(q&&q.name=="table"){var p=r.attributes;q.attributes=CKEDITOR.tools.extend(q.attributes,p);p.style&&q.addStyle(p.style);var o=new CKEDITOR.htmlParser.element("div");o.addStyle("clear","both");r.add(o);delete r.name}},td:function(o){if(o.getAncestor("thead")){o.name="th"}},ol:C,ul:C,dl:C,font:function(r){if(!CKEDITOR.env.gecko&&g(r.parent)){delete r.name;return}r.filterChildren();var q=r.attributes,p=q.style,o=r.parent;if("font"==o.name){CKEDITOR.tools.extend(o.attributes,r.attributes);p&&o.addStyle(p);delete r.name}else{p=p||"";if(q.color){q.color!="#000000"&&(p+="color:"+q.color+";");delete q.color}if(q.face){p+="font-family:"+q.face+";";delete q.face}if(q.size){p+="font-size:"+(q.size>3?"large":q.size<3?"small":"medium")+";";delete q.size}r.name="span";r.addStyle(p)}},span:function(v){if(!CKEDITOR.env.gecko&&g(v.parent)){return false}v.filterChildren();if(f(v)){delete v.name;return null}if(!CKEDITOR.env.gecko&&g(v)){var u=v.firstChild(function(w){return w.value||w.name=="img"}),t=u&&(u.value||"l."),s=t.match(/^([^\s]+?)([.)]?)$/);return D(s,t)}var r=v.children,q=v.attributes,p=q&&q.style,o=r&&r[0];if(p){q.style=H([["line-height"],[/^font-family$/,null,!a?F(K.font_style,"family"):null],[/^font-size$/,null,!a?F(K.fontSize_style,"size"):null],[/^color$/,null,!a?F(K.colorButton_foreStyle,"color"):null],[/^background-color$/,null,!a?F(K.colorButton_backStyle,"color"):null]])(p,v)||""}return null},b:G(K.coreStyles_bold),i:G(K.coreStyles_italic),u:G(K.coreStyles_underline),s:G(K.coreStyles_strike),sup:G(K.coreStyles_superscript),sub:G(K.coreStyles_subscript),a:function(p){var o=p.attributes;if(o&&!o.href&&o.name){delete p.name}},"cke:listbullet":function(o){if(o.getAncestor(/h\d/)&&!K.pasteFromWordNumberedHeadingToList){delete o.name}}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:H(E?[[/^margin$|^margin-(?!bottom|top)/,null,function(r,q,p){if(q.name in {p:1,div:1}){var o=K.contentsLangDirection=="ltr"?"margin-left":"margin-right";if(p=="margin"){r=c(p,r,[o])[o]}else{if(p!=o){return null}}if(r&&!m.test(r)){return[o,r]}}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(p,o){if(o.name=="img"){return p}}],[/^width|height$/,null,function(p,o){if(o.name in {table:1,td:1,th:1,img:1}){return p}}]]:[[/^mso-/],[/-color$/,null,function(o){if(o=="transparent"){return false}if(CKEDITOR.env.gecko){return o.replace(/-moz-use-text-color/g,"transparent")}}],[/^margin$/,m],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],a?[/font-?/]:null],E),width:function(p,o){if(o.name in M.$tableContent){return false}},border:function(p,o){if(o.name in M.$tableContent){return false}},"class":I,bgcolor:I,valign:E?I:function(p,o){o.addStyle("vertical-align",p);return false}},comment:!CKEDITOR.env.ie?function(q,p){var o=q.match(/<img.*?>/),x=q.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(x){var w=x[1]||o&&"l.",v=w&&w.match(/>([^\s]+?)([.)]?)</);return D(v,w)}if(CKEDITOR.env.gecko&&o){var u=CKEDITOR.htmlParser.fragment.fromHtml(o[0]).children[0],t=p.previous,s=t&&t.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/),r=s&&s[1];r&&(u.attributes.src=r);return u}return false}:I}}};var j=function(){this.dataFilter=new CKEDITOR.htmlParser.filter()};j.prototype={toHtml:function(c){var b=CKEDITOR.htmlParser.fragment.fromHtml(c,false),a=new CKEDITOR.htmlParser.basicWriter();b.writeHtml(a,this.dataFilter);return a.getHtml(true)}};CKEDITOR.cleanWord=function(e,d){if(CKEDITOR.env.gecko){e=e.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3")}var c=new j(),b=c.dataFilter;b.addRules(CKEDITOR.plugins.pastefromword.getRules(d));d.fire("beforeCleanWord",{filter:b});try{e=c.toHtml(e,false)}catch(a){alert(d.lang.pastefromword.error)}e=e.replace(/cke:.*?".*?"/g,"");e=e.replace(/style=""/g,"");e=e.replace(/<span>/g,"");return e}})();