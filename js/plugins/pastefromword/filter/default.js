(function(){var t=CKEDITOR.htmlParser.fragment.prototype,s=CKEDITOR.htmlParser.element.prototype;t.onlyChild=s.onlyChild=function(){var c=this.children,b=c.length,a=b==1&&c[0];return a||null};s.removeAnyChildWithName=function(c){var b=this.children,a=[],e;for(var d=0;d<b.length;d++){e=b[d];if(!e.name){continue}if(e.name==c){a.push(e);b.splice(d--,1)}a=a.concat(e.removeAnyChildWithName(c))}return a};s.getAncestor=function(b){var a=this.parent;while(a&&!(a.name&&a.name.match(b))){a=a.parent}return a};t.firstChild=s.firstChild=function(c){var b;for(var a=0;a<this.children.length;a++){b=this.children[a];if(c(b)){return b}else{if(b.name){b=b.firstChild(c);if(b){return b}}}}return null};s.addStyle=function(c,b,a){var d=this;var g,f="";if(typeof b=="string"){f+=c+":"+b+";"}else{if(typeof c=="object"){for(var e in c){if(c.hasOwnProperty(e)){f+=e+":"+c[e]+";"}}}else{f+=c}a=b}if(!d.attributes){d.attributes={}}g=d.attributes.style||"";g=(a?[f,g]:[g,f]).join(";");d.attributes.style=g.replace(/^;|;(?=;)/,"")};CKEDITOR.dtd.parentOf=function(c){var b={};for(var a in this){if(a.indexOf("$")==-1&&this[a][c]){b[a]=1}}return b};var r=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,q=/^(?:\b0[^\s]*\s*){1,4}$/,p="^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$",o=new RegExp(p),n=new RegExp(p.toUpperCase()),m=0,l;CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(c,b){var a=new CKEDITOR.htmlParser.element("cke:listbullet"),d;if(!c){c="decimal";d="ol"}else{if(c[2]){if(!isNaN(c[1])){c="decimal"}else{if(o.test(c[1])){c="lower-roman"}else{if(n.test(c[1])){c="upper-roman"}else{if(/^[a-z]+$/.test(c[1])){c="lower-alpha"}else{if(/^[A-Z]+$/.test(c[1])){c="upper-alpha"}else{c="decimal"}}}}}d="ol"}else{if(/[l\u00B7\u2002]/.test(c[1])){c="disc"}else{if(/[\u006F\u00D8]/.test(c[1])){c="circle"}else{if(/[\u006E\u25C6]/.test(c[1])){c="square"}else{c="disc"}}}d="ul"}}a.attributes={"cke:listtype":d,style:"list-style-type:"+c+";"};a.add(new CKEDITOR.htmlParser.text(b));return a},isListBulletIndicator:function(b){var a=b.attributes&&b.attributes.style;if(/mso-list\s*:\s*Ignore/i.test(a)){return true}},isContainingOnlySpaces:function(b){var a;return(a=b.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(a.value)},resolveList:function(c){var b=c.attributes,a;if((a=c.removeAnyChildWithName("cke:listbullet"))&&a.length&&(a=a[0])){c.name="cke:li";if(b.style){b.style=CKEDITOR.plugins.pastefromword.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(g){var f=g.split(" ");g=CKEDITOR.plugins.pastefromword.utils.convertToPx(f[3]||f[1]||f[0]);g=parseInt(g,10);if(!m&&l&&g>l){m=g-l}b["cke:margin"]=l=g}]])(b.style,c)||""}var e=a.attributes,d=e.style;c.addStyle(d);CKEDITOR.tools.extend(b,e);return true}return false},convertToPx:(function(){var a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(a);return function(b){if(r.test(b)){a.setStyle("width",b);return a.$.clientWidth+"px"}return b}})(),getStyleComponents:(function(){var a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(a);return function(c,b,g){a.setStyle(c,b);var f={},e=g.length;for(var d=0;d<e;d++){f[g[d]]=a.getStyle(g[d])}return f}})(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(h){var g=h.attributes,f=h.parent,e,d=1;while(f){f.attributes&&f.attributes["cke:list"]&&d++;f=f.parent}switch(g.type){case"a":e="lower-alpha";break}var c=h.children,b;for(var a=0;a<c.length;a++){b=c[a];var x=b.attributes;if(b.name in CKEDITOR.dtd.$listItem){var w=b.children,j=w.length,i=w[j-1];if(i.name in CKEDITOR.dtd.$list){c.splice(a+1,0,i);i.parent=h;if(!--w.length){c.splice(a,1)}}b.name="cke:li";x["cke:indent"]=d;l=0;x["cke:listtype"]=h.name;e&&b.addStyle("list-style-type",e,true)}}delete h.name;g["cke:list"]=1},assembleList:function(h){var g=h.children,f,e,d,c,b,a,B,A,z;for(var y=0;y<g.length;y++){f=g[y];if("cke:li"==f.name){f.name="li";e=f;d=e.attributes;c=e.attributes["cke:listtype"];b=parseInt(d["cke:indent"],10)||m&&Math.ceil(d["cke:margin"]/m)||1;d.style&&(d.style=CKEDITOR.plugins.pastefromword.filters.stylesFilter([["list-style-type",c=="ol"?"decimal":"disc"]])(d.style)||"");if(!B){B=new CKEDITOR.htmlParser.element(c);B.add(e);g[y]=B}else{if(b>z){B=new CKEDITOR.htmlParser.element(c);B.add(e);a.add(B)}else{if(b<z){var j=z-b,i;while(j--&&(i=B.parent)){B=i.parent}B.add(e)}else{B.add(e)}}g.splice(y--,1)}a=e;z=b}else{B=null}}m=0},falsyFilter:function(a){return false},stylesFilter:function(b,a){return function(c,f){var e=[];c.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(B,A,z){A=A.toLowerCase();A=="font-family"&&(z=z.replace(/["']/g,""));var y,j,i,h;for(var g=0;g<b.length;g++){if(b[g]){y=b[g][0];j=b[g][1];i=b[g][2];h=b[g][3];if(A.match(y)&&(!j||z.match(j))){A=h||A;a&&(i=i||z);if(typeof i=="function"){i=i(z,f,A)}if(i&&i.push){A=i[0],i=i[1]}if(typeof i=="string"){e.push([A,i])}return}}}!a&&e.push([A,z])});for(var d=0;d<e.length;d++){e[d]=e[d].join(":")}return e.length?e.join(";")+";":false}},elementMigrateFilter:function(b,a){return function(c){var d=a?new CKEDITOR.style(b,a)._.definition:b;c.name=d.element;CKEDITOR.tools.extend(c.attributes,CKEDITOR.tools.clone(d.attributes));c.addStyle(CKEDITOR.style.getStyleText(d))}},styleMigrateFilter:function(c,b){var a=this.elementMigrateFilter;return function(g,f){var e=new CKEDITOR.htmlParser.element(null),d={};d[b]=g;a(c,d)(e);e.children=f.children;f.children=[e]}},bogusAttrFilter:function(b,a){if(a.name.indexOf("cke:")==-1){return false}},applyStyleFilter:null},getRules:function(N){var M=CKEDITOR.dtd,L=CKEDITOR.tools.extend({},M.$block,M.$listItem,M.$tableContent),K=N.config,J=this.filters,I=J.falsyFilter,G=J.stylesFilter,E=J.elementMigrateFilter,i=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),g=this.utils.createListBulletMarker,f=J.flattenList,e=J.assembleList,d=this.utils.isListBulletIndicator,c=this.utils.isContainingOnlySpaces,b=this.utils.resolveList,a=this.utils.convertToPx,H=this.utils.getStyleComponents,F=this.utils.listDtdParents,j=K.pasteFromWordRemoveFontStyles!==false,h=K.pasteFromWordRemoveStyles!==false;return{elementNames:[[/meta|link|script/,""]],root:function(u){u.filterChildren();e(u)},elements:{"^":function(v){var u;if(CKEDITOR.env.gecko&&(u=J.applyStyleFilter)){u(v)}},$:function(x){var w=x.name||"",v=x.attributes;if(w in L&&v.style){v.style=G([[/^(:?width|height)$/,null,a]])(v.style)||""}if(w.match(/h\d/)){x.filterChildren();if(b(x)){return}E(K["format_"+w])(x)}else{if(w in M.$inline){x.filterChildren();if(c(x)){delete x.name}}else{if(w.indexOf(":")!=-1&&w.indexOf("cke")==-1){x.filterChildren();if(w=="v:imagedata"){var u=x.attributes["o:href"];if(u){x.attributes.src=u}x.name="img";return}delete x.name}}}if(w in F){x.filterChildren();e(x)}},style:function(x){if(CKEDITOR.env.gecko){var w=x.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),v=w&&w[1],u={};if(v){v.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(B,A,z){A=A.split(",");var y=A.length,D;for(var C=0;C<y;C++){CKEDITOR.tools.trim(A[C]).replace(/^(\w+)(\.[\w-]+)?$/g,function(T,S,R){S=S||"*";R=R.substring(1,R.length);if(R.match(/MsoNormal/)){return}if(!u[S]){u[S]={}}if(R){u[S][R]=z}else{u[S]=z}})}});J.applyStyleFilter=function(B){var A=u["*"]?"*":B.name,z=B.attributes&&B.attributes["class"],y;if(A in u){y=u[A];if(typeof y=="object"){y=y[z]}y&&B.addStyle(y,true)}}}}return false},p:function(u){u.filterChildren();if(b(u)){return}if(K.enterMode==CKEDITOR.ENTER_BR){delete u.name;u.add(new CKEDITOR.htmlParser.element("br"))}else{E(K["format_"+(K.enterMode==CKEDITOR.ENTER_P?"p":"div")])(u)}},div:function(x){var w=x.onlyChild();if(w&&w.name=="table"){var v=x.attributes;w.attributes=CKEDITOR.tools.extend(w.attributes,v);v.style&&w.addStyle(v.style);var u=new CKEDITOR.htmlParser.element("div");u.addStyle("clear","both");x.add(u);delete x.name}},td:function(u){if(u.getAncestor("thead")){u.name="th"}},ol:f,ul:f,dl:f,font:function(x){if(!CKEDITOR.env.gecko&&d(x.parent)){delete x.name;return}x.filterChildren();var w=x.attributes,v=w.style,u=x.parent;if("font"==u.name){CKEDITOR.tools.extend(u.attributes,x.attributes);v&&u.addStyle(v);delete x.name}else{v=v||"";if(w.color){w.color!="#000000"&&(v+="color:"+w.color+";");delete w.color}if(w.face){v+="font-family:"+w.face+";";delete w.face}if(w.size){v+="font-size:"+(w.size>3?"large":w.size<3?"small":"medium")+";";delete w.size}x.name="span";x.addStyle(v)}},span:function(B){if(!CKEDITOR.env.gecko&&d(B.parent)){return false}B.filterChildren();if(c(B)){delete B.name;return null}if(!CKEDITOR.env.gecko&&d(B)){var A=B.firstChild(function(C){return C.value||C.name=="img"}),z=A&&(A.value||"l."),y=z.match(/^([^\s]+?)([.)]?)$/);return g(y,z)}var x=B.children,w=B.attributes,v=w&&w.style,u=x&&x[0];if(v){w.style=G([["line-height"],[/^font-family$/,null,!j?i(K.font_style,"family"):null],[/^font-size$/,null,!j?i(K.fontSize_style,"size"):null],[/^color$/,null,!j?i(K.colorButton_foreStyle,"color"):null],[/^background-color$/,null,!j?i(K.colorButton_backStyle,"color"):null]])(v,B)||""}return null},b:E(K.coreStyles_bold),i:E(K.coreStyles_italic),u:E(K.coreStyles_underline),s:E(K.coreStyles_strike),sup:E(K.coreStyles_superscript),sub:E(K.coreStyles_subscript),a:function(v){var u=v.attributes;if(u&&!u.href&&u.name){delete v.name}},"cke:listbullet":function(u){if(u.getAncestor(/h\d/)&&!K.pasteFromWordNumberedHeadingToList){delete u.name}}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:G(h?[[/^margin$|^margin-(?!bottom|top)/,null,function(x,w,v){if(w.name in {p:1,div:1}){var u=K.contentsLangDirection=="ltr"?"margin-left":"margin-right";if(v=="margin"){x=H(v,x,[u])[u]}else{if(v!=u){return null}}if(x&&!q.test(x)){return[u,x]}}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(v,u){if(u.name=="img"){return v}}],[/^width|height$/,null,function(v,u){if(u.name in {table:1,td:1,th:1,img:1}){return v}}]]:[[/^mso-/],[/-color$/,null,function(u){if(u=="transparent"){return false}if(CKEDITOR.env.gecko){return u.replace(/-moz-use-text-color/g,"transparent")}}],[/^margin$/,q],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],j?[/font-?/]:null],h),width:function(v,u){if(u.name in M.$tableContent){return false}},border:function(v,u){if(u.name in M.$tableContent){return false}},"class":I,bgcolor:I,valign:h?I:function(v,u){u.addStyle("vertical-align",v);return false}},comment:!CKEDITOR.env.ie?function(D,C){var B=D.match(/<img.*?>/),A=D.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(A){var z=A[1]||B&&"l.",y=z&&z.match(/>([^\s]+?)([.)]?)</);return g(y,z)}if(CKEDITOR.env.gecko&&B){var x=CKEDITOR.htmlParser.fragment.fromHtml(B[0]).children[0],w=C.previous,v=w&&w.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/),u=v&&v[1];u&&(x.attributes.src=u);return x}return false}:I}}};var k=function(){this.dataFilter=new CKEDITOR.htmlParser.filter()};k.prototype={toHtml:function(c){var b=CKEDITOR.htmlParser.fragment.fromHtml(c,false),a=new CKEDITOR.htmlParser.basicWriter();b.writeHtml(a,this.dataFilter);return a.getHtml(true)}};CKEDITOR.cleanWord=function(c,b){if(CKEDITOR.env.gecko){c=c.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3")}var a=new k(),e=a.dataFilter;e.addRules(CKEDITOR.plugins.pastefromword.getRules(b));b.fire("beforeCleanWord",{filter:e});try{c=a.toHtml(c,false)}catch(d){alert(b.lang.pastefromword.error)}c=c.replace(/cke:.*?".*?"/g,"");c=c.replace(/style=""/g,"");c=c.replace(/<span>/g,"");return c}})();