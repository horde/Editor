(function(){var b=CKEDITOR.document;CKEDITOR.dialog.add("templates",function(a){function n(v,u){v.setHtml("");for(var t=0;t<u.length;t++){var s=CKEDITOR.getTemplates(u[t]),h=s.imagesPath,g=s.templates,f=g.length;for(var e=0;e<f;e++){var d=g[e],c=m(d,h);c.setAttribute("aria-posinset",e+1);c.setAttribute("aria-setsize",f);v.append(c)}}}function m(f,e){var d=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),c='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';if(f.image&&e){c+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(e+f.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>'}c+='<td style="white-space:normal;"><span class="cke_tpl_title">'+f.title+"</span><br/>";if(f.description){c+="<span>"+f.description+"</span>"}c+="</td></tr></table>";d.getFirst().setHtml(c);d.on("click",function(){l(f.html)});return d}function l(e){var d=CKEDITOR.dialog.getCurrent(),c=d.getValueOf("selectTpl","chkInsertOpt");if(c){a.on("contentDom",function(g){g.removeListener();d.hide();var f=new CKEDITOR.dom.range(a.document);f.moveToElementEditStart(a.document.getBody());f.select(true);setTimeout(function(){a.fire("saveSnapshot")},0)});a.fire("saveSnapshot");a.setData(e)}else{a.insertHtml(e);d.hide()}}function k(g){var f=g.data.getTarget(),e=j.equals(f);if(e||j.contains(f)){var d=g.data.getKeystroke(),c=j.getElementsByTag("a"),h;if(c){if(e){h=c.getItem(0)}else{switch(d){case 40:h=f.getNext();break;case 38:h=f.getPrevious();break;case 13:case 32:f.fire("click")}}if(h){h.focus();g.data.preventDefault()}}}}CKEDITOR.skins.load(a,"templates");var j,i="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber();return{title:a.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:a.lang.templates.title,elements:[{type:"vbox",padding:5,children:[{type:"html",html:"<span>"+a.lang.templates.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:true,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+i+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+i+'">'+a.lang.templates.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:a.lang.templates.insertOption,"default":a.config.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var c=this.getContentElement("selectTpl","templatesList");j=c.getElement();CKEDITOR.loadTemplates(a.config.templates_files,function(){var d=a.config.templates.split(",");if(d.length){n(j,d);c.focus()}else{j.setHtml('<div class="cke_tpl_empty"><span>'+a.lang.templates.emptyListMsg+"</span></div>")}});this._.element.on("keydown",k)},onHide:function(){this._.element.removeListener("keydown",k)}}})})();